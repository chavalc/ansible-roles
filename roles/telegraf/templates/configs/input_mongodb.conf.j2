{%- import '_macros.j2' as macros with context -%}

{% set config = item.config|default([]) %}
{% set section = 'inputs.mongodb' -%}

[[inputs.mongodb]]
  ## An array of URLs of the form:
  ##   "mongodb://" [user ":" pass "@"] host [ ":" port]
  ## For example:
  ##   mongodb://user:auth_key@10.10.3.30:27017,
  ##   mongodb://10.10.3.33:18832,
  {{ macros.config_row(config, 'servers', ['mongodb://127.0.0.1:27017']) }}

  ## When true, collect cluster status.
  ## Note that the query that counts jumbo chunks triggers a COLLSCAN, which
  ## may have an impact on performance.
  {{ macros.config_row(config, 'gather_cluster_status', '# gather_cluster_status = true', 0, true) }}

  ## When true, collect per database stats
  {{ macros.config_row(config, 'gather_perdb_stats', '# gather_perdb_stats = false', 0, true) }}

  ## When true, collect per collection stats
  {{ macros.config_row(config, 'gather_col_stats', '# gather_col_stats = false', 0, true) }}

  ## List of db where collections stats are collected
  ## If empty, all db are concerned
  {{ macros.config_row(config, 'col_stats_dbs', '# col_stats_dbs = ["local"]', 0, true) }}

  ## Optional TLS Config
  {{ macros.config_row(config, 'tls_ca', '# tls_ca = "/etc/telegraf/ca.pem"', 0, true) }}
  {{ macros.config_row(config, 'tls_cert', '# tls_cert = "/etc/telegraf/cert.pem"', 0, true) }}
  {{ macros.config_row(config, 'tls_key', '# tls_key = "/etc/telegraf/key.pem"', 0, true) }}
  ## Use TLS but skip chain & host verification
  {{ macros.config_row(config, 'insecure_skip_verify', '# insecure_skip_verify = false', 0, true) }}

{{ macros.config(config, [
  'servers',
  'gather_cluster_status',
  'gather_perdb_stats',
  'gather_col_stats',
  'col_stats_dbs',
  'tls_ca',
  'tls_cert',
  'tls_key',
  'insecure_skip_verify'
], 2) }}

{%- include '_tags.j2' %}